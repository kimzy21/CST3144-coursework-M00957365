<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <link rel="stylesheet" href="./styles.css" />
  <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
  <script src="lessons.js"></script>
  <title>Lesson Store</title>
</head>

<body>
  <div id="webstore">
    <!-- Banner -->
    <header class="banner">
      <button class="checkout-btn" v-on:click="showCheckout">
        <span class="fa-solid fa-cart-shopping"></span>
        Checkout ({{ cartItemCount }})
      </button>
    </header>

    <main>
      <!-- Product Section -->
      <section v-if="showProduct" class="product-section">
        <div class="product-grid">
          <div v-for="product in sortedProducts" class="product-card">
            <img
              v-bind:src="product.image"
              alt="Product Image"
              class="product-image"
            />
            <h2>{{ product.title }}</h2>
            <p class="description">{{ product.description }}</p>
            <p class="price">Price: ${{ product.price }}</p>

            <div class="stock-info">
              <span v-if="itemsLeft(product) === 0" class="out">All out!</span>
              <span
                v-else-if="itemsLeft(product) <= 3"
                class="low-stock"
              >Only {{ itemsLeft(product) }} left!</span>
              <span v-else class="available">Available</span>
            </div>

            <div class="rating">
              <span
                v-for="n in product.rating"
                class="fa-solid fa-star"
              ></span>
              <span
                v-for="n in 5 - product.rating"
                class="fa-regular fa-star"
              ></span>
            </div>

            <button
              v-if="canAddToCart(product)"
              class="add-btn"
              v-on:click="addToCart(product)"
            >
              Add to Cart
            </button>
            <button v-else class="sold-out-btn" disabled>Sold Out</button>
          </div>
        </div>
      </section>

      <!-- Checkout Section -->
      <section v-else class="checkout-section">
        <h2>Checkout</h2>

        <form class="checkout-form">
          <label>
            First Name:
            <input v-model.trim="order.firstName" placeholder="Your First Name" />
          </label>

          <label>
            Last Name:
            <input v-model.trim="order.lastName" placeholder="Your Last Name" />
          </label>

          <label>
            Address:
            <input v-model.trim="order.address" placeholder="Your Address" />
          </label>

          <label>
            City:
            <input v-model="order.city" placeholder="Your City" />
          </label>

          <label>
            District:
            <select v-model="order.state">
              <option disabled value="">Select District</option>
              <option v-for="state in states" :key="state">{{ state }}</option>
            </select>
          </label>

          <label>
            <input
              type="checkbox"
              id="gift"
              v-model="order.gift"
              :true-value="order.sendGift"
              :false-value="order.dontSendGift"
            />
            Ship as gift?
          </label>

          <div class="radio-group">
            <label><input type="radio" value="Home" v-model="order.method" /> Home</label>
            <label><input type="radio" value="Business" v-model="order.method" /> Business</label>
          </div>

          <h3>Order Information</h3>
          <p><strong>Name:</strong> {{ order.firstName }} {{ order.lastName }}</p>
          <p><strong>Address:</strong> {{ order.address }}, {{ order.city }}</p>
          <p><strong>District:</strong> {{ order.state }}</p>
          <p><strong>Shipping:</strong> {{ order.method }}</p>
          <p><strong>Gift:</strong> {{ order.gift }}</p>

          <div class="checkout-buttons">
            <button type="button" v-on:click="submitForm">Submit Order</button>
            <button type="button" v-on:click="showCheckout">Back to Products</button>
          </div>
        </form>
      </section>
    </main>
  </div>

  <!-- Vue Script -->
  <script>
    var webstore = new Vue({
      el: '#webstore',
      data: {
        showProduct: true,
        products: products,
        cart: [],
        order: {
          firstName: '',
          lastName: '',
          address: '',
          city: '',
          state: '',
          method: 'Home',
          gift: 'Do not send as Gift',
          sendGift: 'Send as Gift',
          dontSendGift: 'Do not send as Gift'
        },
        states: ['State 1', 'State 2', 'State 3', 'State 4'],
        message: 'Welcome to the Lesson Store!'
      },
      computed: {
        sortedProducts() {
          return this.products.sort((a, b) => a.price - b.price);
        },
        cartItemCount() {
          return this.cart.length;
        }
      },
      methods: {
        addToCart(product) {
          this.cart.push(product.id);
        },
        cartCount(id) {
          return this.cart.filter(item => item === id).length;
        },
        canAddToCart(product) {
          return product.availableInventory > this.cartCount(product.id);
        },
        itemsLeft(product) {
          return product.availableInventory - this.cartCount(product.id);
        },
        showCheckout() {
          this.showProduct = !this.showProduct;
        },
        submitForm() {
          alert(`Thank you for your order, ${this.order.firstName}!`);
        }
      }
    });
  </script>
</body>
</html>
